{"version":3,"sources":["../src/actions/upload.ts","../src/templates/upload.ts","../src/index.ts"],"sourcesContent":["import {\r\n    Action,\r\n    HandlerCallback,\r\n    IAgentRuntime,\r\n    Memory,\r\n    State,\r\n    ModelClass,\r\n    Content,\r\n    ActionExample,\r\n    generateObjectV2,\r\n} from \"@ai16z/eliza\";\r\nimport { Indexer, ZgFile, getFlowContract } from \"@0glabs/0g-ts-sdk\";\r\nimport { ethers } from \"ethers\";\r\nimport { composeContext } from \"@ai16z/eliza\";\r\nimport { promises as fs } from \"fs\";\r\n\r\nimport { uploadTemplate } from \"../templates/upload\";\r\n\r\nexport interface UploadContent extends Content {\r\n    filePath: string;\r\n}\r\n\r\nfunction isUploadContent(\r\n    _runtime: IAgentRuntime,\r\n    content: any\r\n): content is UploadContent {\r\n    console.log(\"Content for upload\", content);\r\n    return typeof content.filePath === \"string\";\r\n}\r\n\r\nexport const zgUpload: Action = {\r\n    name: \"ZG_UPLOAD\",\r\n    similes: [\r\n        \"UPLOAD_FILE_TO_ZG\",\r\n        \"STORE_FILE_ON_ZG\",\r\n        \"SAVE_FILE_TO_ZG\",\r\n        \"UPLOAD_TO_ZERO_GRAVITY\",\r\n        \"STORE_ON_ZERO_GRAVITY\",\r\n        \"SHARE_FILE_ON_ZG\",\r\n        \"PUBLISH_FILE_TO_ZG\",\r\n    ],\r\n    description: \"Store data using 0G protocol\",\r\n    validate: async (runtime: IAgentRuntime, message: Memory) => {\r\n        const zgIndexerRpc = !!runtime.getSetting(\"ZEROG_INDEXER_RPC\");\r\n        const zgEvmRpc = !!runtime.getSetting(\"ZEROG_EVM_RPC\");\r\n        const zgPrivateKey = !!runtime.getSetting(\"ZEROG_PRIVATE_KEY\");\r\n        const flowAddr = !!runtime.getSetting(\"ZEROG_FLOW_ADDRESS\");\r\n        return zgIndexerRpc && zgEvmRpc && zgPrivateKey && flowAddr;\r\n    },\r\n    handler: async (\r\n        runtime: IAgentRuntime,\r\n        message: Memory,\r\n        state: State,\r\n        _options: any,\r\n        callback: HandlerCallback\r\n    ) => {\r\n        console.log(\"ZG_UPLOAD action called\");\r\n        if (!state) {\r\n            state = (await runtime.composeState(message)) as State;\r\n        } else {\r\n            state = await runtime.updateRecentMessageState(state);\r\n        }\r\n\r\n        // Compose upload context\r\n        const uploadContext = composeContext({\r\n            state,\r\n            template: uploadTemplate,\r\n        });\r\n\r\n        // Generate upload content\r\n        const content = await generateObjectV2({\r\n            runtime,\r\n            context: uploadContext,\r\n            modelClass: ModelClass.LARGE,\r\n        });\r\n\r\n        // Validate upload content\r\n        if (!isUploadContent(runtime, content)) {\r\n            console.error(\"Invalid content for UPLOAD action.\");\r\n            if (callback) {\r\n                callback({\r\n                    text: \"Unable to process 0G upload request. Invalid content provided.\",\r\n                    content: { error: \"Invalid upload content\" },\r\n                });\r\n            }\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            const zgIndexerRpc = runtime.getSetting(\"ZEROG_INDEXER_RPC\");\r\n            const zgEvmRpc = runtime.getSetting(\"ZEROG_EVM_RPC\");\r\n            const zgPrivateKey = runtime.getSetting(\"ZEROG_PRIVATE_KEY\");\r\n            const flowAddr = runtime.getSetting(\"ZEROG_FLOW_ADDRESS\");\r\n            const filePath = content.filePath;\r\n            if (!filePath) {\r\n                console.error(\"File path is required\");\r\n                return false;\r\n            }\r\n\r\n            // Check if file exists and is accessible\r\n            try {\r\n                await fs.access(filePath);\r\n            } catch (error) {\r\n                console.error(\r\n                    `File ${filePath} does not exist or is not accessible:`,\r\n                    error\r\n                );\r\n                return false;\r\n            }\r\n\r\n            const file = await ZgFile.fromFilePath(filePath);\r\n            var [tree, err] = await file.merkleTree();\r\n            if (err === null) {\r\n                console.log(\"File Root Hash: \", tree.rootHash());\r\n            } else {\r\n                console.log(\"Error getting file root hash: \", err);\r\n                return false;\r\n            }\r\n\r\n            const provider = new ethers.JsonRpcProvider(zgEvmRpc);\r\n            const signer = new ethers.Wallet(zgPrivateKey, provider);\r\n            const indexer = new Indexer(zgIndexerRpc);\r\n            const flowContract = getFlowContract(flowAddr, signer);\r\n\r\n            var [tx, err] = await indexer.upload(\r\n                file,\r\n                0,\r\n                zgEvmRpc,\r\n                flowContract\r\n            );\r\n            if (err === null) {\r\n                console.log(\"File uploaded successfully, tx: \", tx);\r\n            } else {\r\n                console.error(\"Error uploading file: \", err);\r\n                return false;\r\n            }\r\n\r\n            await file.close();\r\n        } catch (error) {\r\n            console.error(\"Error getting settings for 0G upload:\", error);\r\n        }\r\n    },\r\n    examples: [\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"upload my resume.pdf file\",\r\n                    action: \"ZG_UPLOAD\",\r\n                },\r\n            },\r\n        ],\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"can you help me upload this document.docx?\",\r\n                    action: \"ZG_UPLOAD\",\r\n                },\r\n            },\r\n        ],\r\n        [\r\n            {\r\n                user: \"{{user1}}\",\r\n                content: {\r\n                    text: \"I need to upload an image file image.png\",\r\n                    action: \"ZG_UPLOAD\",\r\n                },\r\n            },\r\n        ],\r\n    ] as ActionExample[][],\r\n} as Action;\r\n","export const uploadTemplate = `Respond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined.\r\n\r\nExample response:\r\n\\`\\`\\`json\r\n{\r\n    \"filePath\": null,\r\n    \"description\": \"I want to upload a file\"\r\n}\r\n\\`\\`\\`\r\n\r\n{{recentMessages}}\r\n\r\nExtract the user's intention to upload a file from the conversation. Users might express this in various ways, such as:\r\n- \"I want to upload a file\"\r\n- \"upload an image\"\r\n- \"send a photo\"\r\n- \"upload\"\r\n- \"let me share a file\"\r\n\r\nIf the user provides any specific description of the file, include that as well.\r\n\r\nRespond with a JSON markdown block containing only the extracted values.`;\r\n","import { Plugin } from \"@ai16z/eliza\";\r\nimport { zgUpload } from \"./actions/upload\";\r\n\r\nexport const zgPlugin: Plugin = {\r\n    description: \"ZeroG Plugin for Eliza\",\r\n    name: \"ZeroG\",\r\n    actions: [zgUpload],\r\n    evaluators: [],\r\n    providers: [],\r\n};\r\n"],"mappings":"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","names":[]}